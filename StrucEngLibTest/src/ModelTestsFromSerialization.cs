using System;
using IronPython.Hosting;
using Microsoft.Scripting.Hosting;
using NUnit.Framework;
using StrucEngLib;
using StrucEngLib.Model;

namespace StrucEngLibTest
{
    /// <summary></summary>
    public class ModelTestsFromSerialization
    {
        private string m1 =
            "{\"$id\":\"1\",\"$type\":\"StrucEngLib.Model.Workbench, StrucEngLib\",\"Version\":\"1\",\"Layers\":{\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"2\",\"$type\":\"StrucEngLib.Model.Element, StrucEngLib\",\"ElementMaterialElastic\":{\"$id\":\"3\",\"$type\":\"StrucEngLib.Model.ElementMaterialElastic, StrucEngLib\",\"E\":\"33700\",\"V\":\"0.0\",\"P\":\"2500/10**9\"},\"ElementShellSection\":{\"$id\":\"4\",\"$type\":\"StrucEngLib.Model.ElementShellSection, StrucEngLib\",\"Thickness\":\"100\"},\"LayerType\":0,\"Name\":\"elset_wall_right\",\"LoadConstraint\":{\"$id\":\"5\",\"$type\":\"StrucEngLib.Model.ElementLoadConstraint, StrucEngLib\",\"ElementNumber\":100,\"Ex0\":0,\"Ex1\":0,\"Ex2\":1,\"Ey0\":0,\"Ey1\":-1,\"Ey2\":0,\"Ez0\":1,\"Ez1\":0,\"Ez2\":0}},{\"$id\":\"6\",\"$type\":\"StrucEngLib.Model.Element, StrucEngLib\",\"ElementMaterialElastic\":{\"$id\":\"7\",\"$type\":\"StrucEngLib.Model.ElementMaterialElastic, StrucEngLib\",\"E\":\"33700\",\"V\":\"0.0\",\"P\":\"2500/10**9\"},\"ElementShellSection\":{\"$id\":\"8\",\"$type\":\"StrucEngLib.Model.ElementShellSection, StrucEngLib\",\"Thickness\":\"100\"},\"LayerType\":0,\"Name\":\"elset_deck\",\"LoadConstraint\":{\"$id\":\"9\",\"$type\":\"StrucEngLib.Model.ElementLoadConstraint, StrucEngLib\",\"ElementNumber\":0,\"Ex0\":1,\"Ex1\":0,\"Ex2\":0,\"Ey0\":0,\"Ey1\":-1,\"Ey2\":0,\"Ez0\":0,\"Ez1\":0,\"Ez2\":-1}},{\"$id\":\"10\",\"$type\":\"StrucEngLib.Model.Element, StrucEngLib\",\"ElementMaterialElastic\":{\"$id\":\"11\",\"$type\":\"StrucEngLib.Model.ElementMaterialElastic, StrucEngLib\",\"E\":\"33700\",\"V\":\"0.0\",\"P\":\"2500/10**9\"},\"ElementShellSection\":{\"$id\":\"12\",\"$type\":\"StrucEngLib.Model.ElementShellSection, StrucEngLib\",\"Thickness\":\"100\"},\"LayerType\":0,\"Name\":\"elset_wall_left\",\"LoadConstraint\":{\"$id\":\"13\",\"$type\":\"StrucEngLib.Model.ElementLoadConstraint, StrucEngLib\",\"ElementNumber\":200,\"Ex0\":0,\"Ex1\":0,\"Ex2\":-1,\"Ey0\":0,\"Ey1\":-1,\"Ey2\":0,\"Ez0\":-1,\"Ez1\":0,\"Ez2\":0}},{\"$id\":\"14\",\"$type\":\"StrucEngLib.Model.Set, StrucEngLib\",\"SetDisplacementType\":2,\"Name\":\"nset_pinned\",\"LayerType\":1}]},\"Loads\":{\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Load, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"15\",\"$type\":\"StrucEngLib.Model.LoadGravity, StrucEngLib\",\"Layers\":{\"$id\":\"16\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$ref\":\"2\"},{\"$ref\":\"6\"},{\"$ref\":\"10\"}]},\"LoadType\":2,\"X\":\"0.0\",\"Y\":\"0.0\",\"Z\":\"1.0\",\"Description\":\"Gravity (elset_wall_right; elset_deck; elset_wall_left; )\"},{\"$id\":\"17\",\"$type\":\"StrucEngLib.Model.LoadArea, StrucEngLib\",\"Z\":\"0.03\",\"X\":\"\",\"Y\":\"\",\"Axes\":\"local\",\"Layers\":{\"$id\":\"18\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$ref\":\"6\"}]},\"LoadType\":1,\"Description\":\"Area (elset_deck; )\"},{\"$id\":\"19\",\"$type\":\"StrucEngLib.Model.LoadPoint, StrucEngLib\",\"X\":\"10\",\"Layers\":{\"$id\":\"20\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$ref\":\"6\"}]},\"LoadType\":3,\"Description\":\"Point (elset_deck; )\"}]},\"Steps\":{\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Step, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"21\",\"$type\":\"StrucEngLib.Model.Step, StrucEngLib\",\"Entries\":{\"$id\":\"22\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.StepEntry, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"23\",\"$type\":\"StrucEngLib.Model.StepEntry, StrucEngLib\",\"Type\":1,\"Value\":{\"$ref\":\"14\"}}]},\"Order\":\"1\",\"Setting\":{\"$id\":\"24\",\"$type\":\"StrucEngLib.Model.AnalysisSetting, StrucEngLib\",\"StepId\":\"1\",\"Include\":true,\"Rf\":false,\"Rm\":false,\"U\":false,\"Ur\":false,\"Cf\":false,\"Cm\":false,\"SectionMoments\":false,\"ShellForces\":false,\"AnySettingEnabled\":false}},{\"$id\":\"25\",\"$type\":\"StrucEngLib.Model.Step, StrucEngLib\",\"Entries\":{\"$id\":\"26\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.StepEntry, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"27\",\"$type\":\"StrucEngLib.Model.StepEntry, StrucEngLib\",\"Type\":0,\"Value\":{\"$ref\":\"15\"}}]},\"Order\":\"2\",\"Setting\":{\"$id\":\"28\",\"$type\":\"StrucEngLib.Model.AnalysisSetting, StrucEngLib\",\"StepId\":\"2\",\"Include\":true,\"Rf\":false,\"Rm\":false,\"U\":true,\"Ur\":false,\"Cf\":false,\"Cm\":false,\"SectionMoments\":true,\"ShellForces\":true,\"AnySettingEnabled\":true}},{\"$id\":\"29\",\"$type\":\"StrucEngLib.Model.Step, StrucEngLib\",\"Entries\":{\"$id\":\"30\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.StepEntry, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"31\",\"$type\":\"StrucEngLib.Model.StepEntry, StrucEngLib\",\"Type\":0,\"Value\":{\"$ref\":\"19\"}}]},\"Order\":\"3\",\"Setting\":{\"$id\":\"32\",\"$type\":\"StrucEngLib.Model.AnalysisSetting, StrucEngLib\",\"StepId\":\"3\",\"Include\":true,\"Rf\":false,\"Rm\":false,\"U\":true,\"Ur\":false,\"Cf\":false,\"Cm\":false,\"SectionMoments\":false,\"ShellForces\":false,\"AnySettingEnabled\":true}}]},\"FileName\":\"C:\\Temp\\Rahmen\",\"SandwichModel\":{\"$id\":\"33\",\"$type\":\"StrucEngLib.Model.Sm.SandwichModel, StrucEngLib\",\"FileName\":\"C:\\Temp\\Rahmen\",\"AdditionalProperties\":{\"$id\":\"34\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"35\",\"$type\":\"StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib\",\"Layer\":{\"$ref\":\"2\"},\"DStrichBot\":\"1\",\"DStrichTop\":\"3\",\"FcK\":\"4\",\"FcThetaGradKern\":\"5\",\"FsD\":\"6\",\"AlphaBot\":\"7\",\"BetaBot\":\"8\",\"AlphaTop\":\"9\",\"BetaTop\":\"18\"},{\"$id\":\"36\",\"$type\":\"StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib\",\"Layer\":{\"$ref\":\"6\"},\"DStrichBot\":\"40\",\"DStrichTop\":\"40\",\"FcK\":\"20\",\"FcThetaGradKern\":\"45\",\"FsD\":\"435\",\"AlphaBot\":\"0\",\"BetaBot\":\"90\",\"AlphaTop\":\"0\",\"BetaTop\":\"90\"},{\"$id\":\"37\",\"$type\":\"StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib\",\"Layer\":{\"$ref\":\"10\"},\"DStrichBot\":\"40\",\"DStrichTop\":\"40\",\"FcK\":\"20\",\"FcThetaGradKern\":\"45\",\"FsD\":\"435\",\"AlphaBot\":\"0\",\"BetaBot\":\"90\",\"AlphaTop\":\"0\",\"BetaTop\":\"90\"}]},\"AnalysisSettings\":{\"$id\":\"38\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Sm.SmAnalysisSetting, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"39\",\"$type\":\"StrucEngLib.Model.Sm.SmAnalysisSetting, StrucEngLib\",\"Include\":true,\"Step\":{\"$ref\":\"25\"},\"AxesScale\":\"2\",\"DruckzonenIteration\":\"true\",\"MindestBewehrung\":\"true\",\"Code\":\"sia\",\"Schubnachweis\":\"sia\",\"AsXiBot\":true,\"AsXiTop\":true,\"AsEtaBot\":true,\"AsEtaTop\":true,\"AsZ\":true,\"CCBot\":true,\"CCTop\":true,\"KBot\":true,\"KTop\":true,\"TBot\":true,\"TTop\":true,\"PsiBot\":true,\"PsiTop\":true,\"FallBot\":true,\"FallTop\":true,\"MCcBot\":true,\"MCcTop\":true,\"MShearC\":true,\"MCTotal\":true},{\"$id\":\"40\",\"$type\":\"StrucEngLib.Model.Sm.SmAnalysisSetting, StrucEngLib\",\"Include\":false,\"Step\":{\"$ref\":\"29\"},\"AxesScale\":\"\",\"DruckzonenIteration\":\"true\",\"MindestBewehrung\":\"true\",\"Code\":\"\",\"Schubnachweis\":\"\",\"AsXiBot\":true,\"AsXiTop\":true,\"AsEtaBot\":true,\"AsEtaTop\":true,\"AsZ\":true,\"CCBot\":true,\"CCTop\":true,\"KBot\":true,\"KTop\":true,\"TBot\":true,\"TTop\":true,\"PsiBot\":true,\"PsiTop\":true,\"FallBot\":true,\"FallTop\":true,\"MCcBot\":true,\"MCcTop\":true,\"MShearC\":true,\"MCTotal\":true}]}}}";

        private string m2 =
            "{\"$id\":\"1\",\"$type\":\"StrucEngLib.Model.Workbench, StrucEngLib\",\"Version\":\"1\",\"Layers\":{\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"2\",\"$type\":\"StrucEngLib.Model.Element, StrucEngLib\",\"ElementMaterialElastic\":{\"$id\":\"3\",\"$type\":\"StrucEngLib.Model.ElementMaterialElastic, StrucEngLib\",\"E\":\"33700\",\"V\":\"0.0\",\"P\":\"2500/10**9\"},\"ElementShellSection\":{\"$id\":\"4\",\"$type\":\"StrucEngLib.Model.ElementShellSection, StrucEngLib\",\"Thickness\":\"100\"},\"LayerType\":0,\"Name\":\"elset_wall_right\",\"LoadConstraint\":{\"$id\":\"5\",\"$type\":\"StrucEngLib.Model.ElementLoadConstraint, StrucEngLib\",\"ElementNumber\":100,\"Ex0\":0,\"Ex1\":0,\"Ex2\":1,\"Ey0\":0,\"Ey1\":-1,\"Ey2\":0,\"Ez0\":1,\"Ez1\":0,\"Ez2\":0}},{\"$id\":\"6\",\"$type\":\"StrucEngLib.Model.Element, StrucEngLib\",\"ElementMaterialElastic\":{\"$id\":\"7\",\"$type\":\"StrucEngLib.Model.ElementMaterialElastic, StrucEngLib\",\"E\":\"33700\",\"V\":\"0.0\",\"P\":\"2500/10**9\"},\"ElementShellSection\":{\"$id\":\"8\",\"$type\":\"StrucEngLib.Model.ElementShellSection, StrucEngLib\",\"Thickness\":\"100\"},\"LayerType\":0,\"Name\":\"elset_deck\",\"LoadConstraint\":{\"$id\":\"9\",\"$type\":\"StrucEngLib.Model.ElementLoadConstraint, StrucEngLib\",\"ElementNumber\":0,\"Ex0\":1,\"Ex1\":0,\"Ex2\":0,\"Ey0\":0,\"Ey1\":-1,\"Ey2\":0,\"Ez0\":0,\"Ez1\":0,\"Ez2\":-1}},{\"$id\":\"10\",\"$type\":\"StrucEngLib.Model.Element, StrucEngLib\",\"ElementMaterialElastic\":{\"$id\":\"11\",\"$type\":\"StrucEngLib.Model.ElementMaterialElastic, StrucEngLib\",\"E\":\"33700\",\"V\":\"0.0\",\"P\":\"2500/10**9\"},\"ElementShellSection\":{\"$id\":\"12\",\"$type\":\"StrucEngLib.Model.ElementShellSection, StrucEngLib\",\"Thickness\":\"100\"},\"LayerType\":0,\"Name\":\"elset_wall_left\",\"LoadConstraint\":{\"$id\":\"13\",\"$type\":\"StrucEngLib.Model.ElementLoadConstraint, StrucEngLib\",\"ElementNumber\":200,\"Ex0\":0,\"Ex1\":0,\"Ex2\":-1,\"Ey0\":0,\"Ey1\":-1,\"Ey2\":0,\"Ez0\":-1,\"Ez1\":0,\"Ez2\":0}},{\"$id\":\"14\",\"$type\":\"StrucEngLib.Model.Set, StrucEngLib\",\"SetDisplacementType\":2,\"Name\":\"nset_pinned\",\"LayerType\":1}]},\"Loads\":{\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Load, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"15\",\"$type\":\"StrucEngLib.Model.LoadGravity, StrucEngLib\",\"Layers\":{\"$id\":\"16\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$ref\":\"6\"}]},\"LoadType\":2,\"X\":\"0.0\",\"Y\":\"0.0\",\"Z\":\"1.0\",\"Description\":\"Gravity (elset_deck; )\"},{\"$id\":\"17\",\"$type\":\"StrucEngLib.Model.LoadArea, StrucEngLib\",\"Z\":\"0.03\",\"Axes\":\"local\",\"Layers\":{\"$id\":\"18\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$ref\":\"6\"},{\"$ref\":\"10\"}]},\"LoadType\":1,\"Description\":\"Area (elset_deck; elset_wall_left; )\"},{\"$id\":\"19\",\"$type\":\"StrucEngLib.Model.LoadPoint, StrucEngLib\",\"X\":\"10\",\"Layers\":{\"$id\":\"20\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Layer, StrucEngLib]], mscorlib\",\"$values\":[{\"$ref\":\"2\"}]},\"LoadType\":3,\"Description\":\"Point (elset_wall_right; )\"}]},\"Steps\":{\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Step, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"21\",\"$type\":\"StrucEngLib.Model.Step, StrucEngLib\",\"Entries\":{\"$id\":\"22\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.StepEntry, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"23\",\"$type\":\"StrucEngLib.Model.StepEntry, StrucEngLib\",\"Type\":1,\"Value\":{\"$ref\":\"14\"}}]},\"Order\":\"2\",\"Setting\":{\"$id\":\"24\",\"$type\":\"StrucEngLib.Model.AnalysisSetting, StrucEngLib\",\"StepId\":\"2\",\"Include\":true,\"Rf\":false,\"Rm\":false,\"U\":false,\"Ur\":false,\"Cf\":false,\"Cm\":false,\"SectionMoments\":false,\"ShellForces\":false,\"AnySettingEnabled\":false}},{\"$id\":\"25\",\"$type\":\"StrucEngLib.Model.Step, StrucEngLib\",\"Entries\":{\"$id\":\"26\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.StepEntry, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"27\",\"$type\":\"StrucEngLib.Model.StepEntry, StrucEngLib\",\"Type\":0,\"Value\":{\"$ref\":\"15\"}},{\"$id\":\"28\",\"$type\":\"StrucEngLib.Model.StepEntry, StrucEngLib\",\"Type\":0,\"Value\":{\"$ref\":\"17\"}}]},\"Order\":\"3\",\"Setting\":{\"$id\":\"29\",\"$type\":\"StrucEngLib.Model.AnalysisSetting, StrucEngLib\",\"StepId\":\"3\",\"Include\":true,\"Rf\":false,\"Rm\":false,\"U\":true,\"Ur\":false,\"Cf\":false,\"Cm\":false,\"SectionMoments\":false,\"ShellForces\":false,\"AnySettingEnabled\":true}}]},\"FileName\":\"C:\\Temp\\Rahmen\",\"SandwichModel\":{\"$id\":\"30\",\"$type\":\"StrucEngLib.Model.Sm.SandwichModel, StrucEngLib\",\"FileName\":\"C:\\Temp\\Rahmen\",\"AdditionalProperties\":{\"$id\":\"31\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"32\",\"$type\":\"StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib\",\"Layer\":{\"$ref\":\"2\"},\"DStrichBot\":\"1\",\"DStrichTop\":\"3\",\"FcK\":\"4\",\"FcThetaGradKern\":\"5\",\"FsD\":\"6\",\"AlphaBot\":\"7\",\"BetaBot\":\"8\",\"AlphaTop\":\"9\",\"BetaTop\":\"18\"},{\"$id\":\"33\",\"$type\":\"StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib\",\"Layer\":{\"$ref\":\"6\"},\"DStrichBot\":\"40\",\"DStrichTop\":\"40\",\"FcK\":\"20\",\"FcThetaGradKern\":\"45\",\"FsD\":\"435\",\"AlphaBot\":\"0\",\"BetaBot\":\"90\",\"AlphaTop\":\"0\",\"BetaTop\":\"90\"},{\"$id\":\"34\",\"$type\":\"StrucEngLib.Model.Sm.SandwichProperty, StrucEngLib\",\"Layer\":{\"$ref\":\"10\"},\"DStrichBot\":\"40\",\"DStrichTop\":\"40\",\"FcK\":\"20\",\"FcThetaGradKern\":\"45\",\"FsD\":\"435\",\"AlphaBot\":\"0\",\"BetaBot\":\"90\",\"AlphaTop\":\"0\",\"BetaTop\":\"90\"}]},\"AnalysisSettings\":{\"$id\":\"35\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.Sm.SmAnalysisSetting, StrucEngLib]], mscorlib\",\"$values\":[{\"$id\":\"36\",\"$type\":\"StrucEngLib.Model.Sm.SmAnalysisSetting, StrucEngLib\",\"Include\":false,\"Step\":{\"$id\":\"37\",\"$type\":\"StrucEngLib.Model.Step, StrucEngLib\",\"Entries\":{\"$id\":\"38\",\"$type\":\"System.Collections.Generic.List`1[[StrucEngLib.Model.StepEntry, StrucEngLib]], mscorlib\",\"$values\":[]},\"Order\":\"3\",\"Setting\":{\"$id\":\"39\",\"$type\":\"StrucEngLib.Model.AnalysisSetting, StrucEngLib\",\"StepId\":\"3\",\"Include\":true,\"Rf\":false,\"Rm\":false,\"U\":true,\"Ur\":false,\"Cf\":false,\"Cm\":false,\"SectionMoments\":false,\"ShellForces\":false,\"AnySettingEnabled\":true}},\"AxesScale\":\"\",\"DruckzonenIteration\":\"true\",\"MindestBewehrung\":\"true\",\"Code\":\"\",\"Schubnachweis\":\"\",\"AsXiBot\":true,\"AsXiTop\":true,\"AsEtaBot\":true,\"AsEtaTop\":true,\"AsZ\":true,\"CCBot\":true,\"CCTop\":true,\"KBot\":true,\"KTop\":true,\"TBot\":true,\"TTop\":true,\"PsiBot\":true,\"PsiTop\":true,\"FallBot\":true,\"FallTop\":true,\"MCcBot\":true,\"MCcTop\":true,\"MShearC\":true,\"MCTotal\":true}]}}}";


        public CompiledCode CompilePython(string c)
        {
            ScriptEngine engine = Python.CreateEngine();
            ScriptSource scriptSource = engine.CreateScriptSourceFromString(c);
            CompiledCode code = scriptSource.Compile();
            return code;
        }


        private void TestModel(string data)
        {
            var bench = WorkbenchFactory.Instance.DeserializeFromString(data);
            var gen = new CompasFea1CodeGenerator();
            var res = gen.GenerateLinFeCode(bench);
            Console.WriteLine(res);
            Assert.IsNotEmpty(res);
            Assert.IsNotNull(res);

            var code = CompilePython(res);
            Console.WriteLine(code.ToString());
            Assert.NotNull(code.ToString());
        }

        [Test]
        public void TestModel1()
        {
            TestModel(m1);
        }

        [Test]
        public void TestModel2()
        {
            TestModel(m2);
        }
    }
}